<!DOCTYPE html>
<html>
<head>
    <title>ç§äººè´¢åŠ¡æŠ¥è¡¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8fafc; margin: 0; padding: 20px; color: #1e293b; }
        .container { max-width: 1000px; margin: auto; }
        .header-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { margin: 0; font-size: 14px; text-transform: uppercase; color: #64748b; }
        .stat-card .amount { font-size: 32px; font-weight: 700; margin: 10px 0; }
        .income { color: #10b981; } .expense { color: #f43f5e; }
        .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .chart-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h2 { text-align: center; font-size: 18px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align:center; margin-bottom:40px;">ğŸ’° ç§äººè´¢åŠ¡çœ‹æ¿</h1>
        
        <div class="header-grid">
            <div class="stat-card">
                <h3>æ€»æ”¶å…¥ (CNY)</h3>
                <div id="total-income" class="amount income">Â¥0.00</div>
            </div>
            <div class="stat-card">
                <h3>æ€»æ”¯å‡º (CNY)</h3>
                <div id="total-expense" class="amount expense">Â¥0.00</div>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart-card">
                <h2>ğŸ• æ”¯å‡ºåˆ†ç±»å æ¯”</h2>
                <canvas id="pieChart"></canvas>
            </div>
            <div class="chart-card">
                <h2>ğŸ“ˆ 30å¤©æ”¯å‡ºè¶‹åŠ¿</h2>
                <canvas id="lineChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        async function loadDashboard() {
            try {
                // âš ï¸ è®°å¾—æ¢æˆä½ ç»‘å®šäº†è‡ªå®šä¹‰åŸŸåçš„ Worker åœ°å€
                const response = await fetch('https://moneydb.pzdmmsd.qzz.io/api/data');
                const data = await response.json();

                // 1. å¡«å……æ€»é¢
                const inc = data.totals.find(t => t.type === 'income')?.total || 0;
                const exp = data.totals.find(t => t.type === 'expense')?.total || 0;
                document.getElementById('total-income').innerText = `Â¥${Number(inc).toLocaleString()}`;
                document.getElementById('total-expense').innerText = `Â¥${Number(exp).toLocaleString()}`;

                // 2. é¥¼å›¾
                new Chart(document.getElementById('pieChart'), {
                    type: 'doughnut',
                    data: {
                        labels: data.pie.map(i => i.category),
                        datasets: [{
                            data: data.pie.map(i => i.value),
                            backgroundColor: ['#6366f1', '#f43f5e', '#eab308', '#22c55e', '#a855f7', '#06b6d4']
                        }]
                    }
                });

                // 3. æŠ˜çº¿å›¾
                new Chart(document.getElementById('lineChart'), {
                    type: 'line',
                    data: {
                        labels: data.line.map(i => i.date),
                        datasets: [{
                            label: 'æ”¯å‡º (CNY)',
                            data: data.line.map(i => i.value),
                            borderColor: '#f43f5e',
                            backgroundColor: 'rgba(244, 63, 94, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    }
                });
            } catch (e) {
                alert("åŠ è½½å¤±è´¥: " + e.message);
            }
        }
        loadDashboard();
    </script>
</body>
</html>

