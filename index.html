<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„è´¢åŠ¡çœ‹æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'PingFang SC', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .dashboard { max-width: 1000px; margin: auto; display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); flex: 1; min-width: 300px; }
        h2 { color: #333; font-size: 18px; margin-top: 0; text-align: center; }
        #status { text-align: center; margin-top: 20px; color: #666; }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: #1a1a1a;">ğŸ“Š æˆ‘çš„ç§äººè´¢åŠ¡æŠ¥è¡¨</h1>
    
    <div class="dashboard">
        <div class="card">
            <h2>ğŸ“ˆ æ¶ˆè´¹è¶‹åŠ¿ (æœ€è¿‘30å¤©)</h2>
            <canvas id="lineChart"></canvas>
        </div>

        <div class="card">
            <h2>ğŸ• æ”¯å‡ºåˆ†ç±»å æ¯”</h2>
            <canvas id="pieChart"></canvas>
        </div>
    </div>

    <div id="status">æ­£åœ¨åŒæ­¥æ•°æ®åº“æ•°æ®...</div>

    <script>
        async function initDashboard() {
            try {
                // âš ï¸ è®°å¾—æ¢æˆä½ è‡ªå·±çš„ Worker åœ°å€
                const response = await fetch('https://money.pzdmmsd.workers.dev/api/data');
                const data = await response.json();

                if (!data.line.length && !data.pie.length) {
                    document.getElementById('status').innerText = "æš‚æ— æ•°æ®ï¼Œå¿«å»è®°è´¦å§ï¼";
                    return;
                }

                // --- 1. æ¸²æŸ“æŠ˜çº¿å›¾ ---
                new Chart(document.getElementById('lineChart'), {
                    type: 'line',
                    data: {
                        labels: data.line.map(item => item.date),
                        datasets: [{
                            label: 'æ¯æ—¥æ”¯å‡º (CNY)',
                            data: data.line.map(item => item.value),
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    }
                });

                // --- 2. æ¸²æŸ“é¥¼çŠ¶å›¾ ---
                new Chart(document.getElementById('pieChart'), {
                    type: 'pie',
                    data: {
                        labels: data.pie.map(item => item.category),
                        datasets: [{
                            data: data.pie.map(item => item.value),
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF']
                        }]
                    },
                    options: {
                        plugins: { legend: { position: 'bottom' } }
                    }
                });

                document.getElementById('status').innerText = "æ•°æ®å·²æ›´æ–°è‡³æœ€æ–°æ—¶åˆ»";
            } catch (err) {
                document.getElementById('status').innerText = "åŠ è½½å¤±è´¥: " + err.message;
            }
        }
        initDashboard();
    </script>
</body>
</html>
